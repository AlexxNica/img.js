(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.img = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
(function (process){
!function(){function n(n){var e=!1;return function(){if(e)throw new Error("Callback was already called.");e=!0,n.apply(t,arguments)}}var t,e,r={};t=this,null!=t&&(e=t.async),r.noConflict=function(){return t.async=e,r};var u=function(n,t){if(n.forEach)return n.forEach(t);for(var e=0;e<n.length;e+=1)t(n[e],e,n)},i=function(n,t){if(n.map)return n.map(t);var e=[];return u(n,function(n,r,u){e.push(t(n,r,u))}),e},c=function(n,t,e){return n.reduce?n.reduce(t,e):(u(n,function(n,r,u){e=t(e,n,r,u)}),e)},o=function(n){if(Object.keys)return Object.keys(n);var t=[];for(var e in n)n.hasOwnProperty(e)&&t.push(e);return t};"undefined"!=typeof process&&process.nextTick?(r.nextTick=process.nextTick,"undefined"!=typeof setImmediate?r.setImmediate=function(n){setImmediate(n)}:r.setImmediate=r.nextTick):"function"==typeof setImmediate?(r.nextTick=function(n){setImmediate(n)},r.setImmediate=r.nextTick):(r.nextTick=function(n){setTimeout(n,0)},r.setImmediate=r.nextTick),r.each=function(t,e,r){if(r=r||function(){},!t.length)return r();var i=0;u(t,function(u){e(u,n(function(n){n?(r(n),r=function(){}):(i+=1,i>=t.length&&r(null))}))})},r.forEach=r.each,r.eachSeries=function(n,t,e){if(e=e||function(){},!n.length)return e();var r=0,u=function(){t(n[r],function(t){t?(e(t),e=function(){}):(r+=1,r>=n.length?e(null):u())})};u()},r.forEachSeries=r.eachSeries,r.eachLimit=function(n,t,e,r){var u=a(t);u.apply(null,[n,e,r])},r.forEachLimit=r.eachLimit;var a=function(n){return function(t,e,r){if(r=r||function(){},!t.length||0>=n)return r();var u=0,i=0,c=0;!function o(){if(u>=t.length)return r();for(;n>c&&i<t.length;)i+=1,c+=1,e(t[i-1],function(n){n?(r(n),r=function(){}):(u+=1,c-=1,u>=t.length?r():o())})}()}},l=function(n){return function(){var t=Array.prototype.slice.call(arguments);return n.apply(null,[r.each].concat(t))}},f=function(n,t){return function(){var e=Array.prototype.slice.call(arguments);return t.apply(null,[a(n)].concat(e))}},s=function(n){return function(){var t=Array.prototype.slice.call(arguments);return n.apply(null,[r.eachSeries].concat(t))}},p=function(n,t,e,r){var u=[];t=i(t,function(n,t){return{index:t,value:n}}),n(t,function(n,t){e(n.value,function(e,r){u[n.index]=r,t(e)})},function(n){r(n,u)})};r.map=l(p),r.mapSeries=s(p),r.mapLimit=function(n,t,e,r){return m(t)(n,e,r)};var m=function(n){return f(n,p)};r.reduce=function(n,t,e,u){r.eachSeries(n,function(n,r){e(t,n,function(n,e){t=e,r(n)})},function(n){u(n,t)})},r.inject=r.reduce,r.foldl=r.reduce,r.reduceRight=function(n,t,e,u){var c=i(n,function(n){return n}).reverse();r.reduce(c,t,e,u)},r.foldr=r.reduceRight;var y=function(n,t,e,r){var u=[];t=i(t,function(n,t){return{index:t,value:n}}),n(t,function(n,t){e(n.value,function(e){e&&u.push(n),t()})},function(n){r(i(u.sort(function(n,t){return n.index-t.index}),function(n){return n.value}))})};r.filter=l(y),r.filterSeries=s(y),r.select=r.filter,r.selectSeries=r.filterSeries;var v=function(n,t,e,r){var u=[];t=i(t,function(n,t){return{index:t,value:n}}),n(t,function(n,t){e(n.value,function(e){e||u.push(n),t()})},function(n){r(i(u.sort(function(n,t){return n.index-t.index}),function(n){return n.value}))})};r.reject=l(v),r.rejectSeries=s(v);var h=function(n,t,e,r){n(t,function(n,t){e(n,function(e){e?(r(n),r=function(){}):t()})},function(n){r()})};r.detect=l(h),r.detectSeries=s(h),r.some=function(n,t,e){r.each(n,function(n,r){t(n,function(n){n&&(e(!0),e=function(){}),r()})},function(n){e(!1)})},r.any=r.some,r.every=function(n,t,e){r.each(n,function(n,r){t(n,function(n){n||(e(!1),e=function(){}),r()})},function(n){e(!0)})},r.all=r.every,r.sortBy=function(n,t,e){r.map(n,function(n,e){t(n,function(t,r){t?e(t):e(null,{value:n,criteria:r})})},function(n,t){if(n)return e(n);var r=function(n,t){var e=n.criteria,r=t.criteria;return r>e?-1:e>r?1:0};e(null,i(t.sort(r),function(n){return n.value}))})},r.auto=function(n,t){t=t||function(){};var e=o(n);if(!e.length)return t(null);var i={},a=[],l=function(n){a.unshift(n)},f=function(n){for(var t=0;t<a.length;t+=1)if(a[t]===n)return void a.splice(t,1)},s=function(){u(a.slice(0),function(n){n()})};l(function(){o(i).length===e.length&&(t(null,i),t=function(){})}),u(e,function(e){var a=n[e]instanceof Function?[n[e]]:n[e],p=function(n){var c=Array.prototype.slice.call(arguments,1);if(c.length<=1&&(c=c[0]),n){var a={};u(o(i),function(n){a[n]=i[n]}),a[e]=c,t(n,a),t=function(){}}else i[e]=c,r.setImmediate(s)},m=a.slice(0,Math.abs(a.length-1))||[],y=function(){return c(m,function(n,t){return n&&i.hasOwnProperty(t)},!0)&&!i.hasOwnProperty(e)};if(y())a[a.length-1](p,i);else{var v=function(){y()&&(f(v),a[a.length-1](p,i))};l(v)}})},r.waterfall=function(n,t){if(t=t||function(){},n.constructor!==Array){var e=new Error("First argument to waterfall must be an array of functions");return t(e)}if(!n.length)return t();var u=function(n){return function(e){if(e)t.apply(null,arguments),t=function(){};else{var i=Array.prototype.slice.call(arguments,1),c=n.next();i.push(c?u(c):t),r.setImmediate(function(){n.apply(null,i)})}}};u(r.iterator(n))()};var d=function(n,t,e){if(e=e||function(){},t.constructor===Array)n.map(t,function(n,t){n&&n(function(n){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),t.call(null,n,e)})},e);else{var r={};n.each(o(t),function(n,e){t[n](function(t){var u=Array.prototype.slice.call(arguments,1);u.length<=1&&(u=u[0]),r[n]=u,e(t)})},function(n){e(n,r)})}};r.parallel=function(n,t){d({map:r.map,each:r.each},n,t)},r.parallelLimit=function(n,t,e){d({map:m(t),each:a(t)},n,e)},r.series=function(n,t){if(t=t||function(){},n.constructor===Array)r.mapSeries(n,function(n,t){n&&n(function(n){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),t.call(null,n,e)})},t);else{var e={};r.eachSeries(o(n),function(t,r){n[t](function(n){var u=Array.prototype.slice.call(arguments,1);u.length<=1&&(u=u[0]),e[t]=u,r(n)})},function(n){t(n,e)})}},r.iterator=function(n){var t=function(e){var r=function(){return n.length&&n[e].apply(null,arguments),r.next()};return r.next=function(){return e<n.length-1?t(e+1):null},r};return t(0)},r.apply=function(n){var t=Array.prototype.slice.call(arguments,1);return function(){return n.apply(null,t.concat(Array.prototype.slice.call(arguments)))}};var g=function(n,t,e,r){var u=[];n(t,function(n,t){e(n,function(n,e){u=u.concat(e||[]),t(n)})},function(n){r(n,u)})};r.concat=l(g),r.concatSeries=s(g),r.whilst=function(n,t,e){n()?t(function(u){return u?e(u):void r.whilst(n,t,e)}):e()},r.doWhilst=function(n,t,e){n(function(u){return u?e(u):void(t()?r.doWhilst(n,t,e):e())})},r.until=function(n,t,e){n()?e():t(function(u){return u?e(u):void r.until(n,t,e)})},r.doUntil=function(n,t,e){n(function(u){return u?e(u):void(t()?e():r.doUntil(n,t,e))})},r.queue=function(t,e){function i(n,t,i,c){t.constructor!==Array&&(t=[t]),u(t,function(t){var u={data:t,callback:"function"==typeof c?c:null};i?n.tasks.unshift(u):n.tasks.push(u),n.saturated&&n.tasks.length===e&&n.saturated(),r.setImmediate(n.process)})}void 0===e&&(e=1);var c=0,o={tasks:[],concurrency:e,saturated:null,empty:null,drain:null,push:function(n,t){i(o,n,!1,t)},unshift:function(n,t){i(o,n,!0,t)},process:function(){if(c<o.concurrency&&o.tasks.length){var e=o.tasks.shift();o.empty&&0===o.tasks.length&&o.empty(),c+=1;var r=function(){c-=1,e.callback&&e.callback.apply(e,arguments),o.drain&&o.tasks.length+c===0&&o.drain(),o.process()},u=n(r);t(e.data,u)}},length:function(){return o.tasks.length},running:function(){return c}};return o},r.cargo=function(n,t){var e=!1,c=[],o={tasks:c,payload:t,saturated:null,empty:null,drain:null,push:function(n,e){n.constructor!==Array&&(n=[n]),u(n,function(n){c.push({data:n,callback:"function"==typeof e?e:null}),o.saturated&&c.length===t&&o.saturated()}),r.setImmediate(o.process)},process:function a(){if(!e){if(0===c.length)return void(o.drain&&o.drain());var r="number"==typeof t?c.splice(0,t):c.splice(0),l=i(r,function(n){return n.data});o.empty&&o.empty(),e=!0,n(l,function(){e=!1;var n=arguments;u(r,function(t){t.callback&&t.callback.apply(null,n)}),a()})}},length:function(){return c.length},running:function(){return e}};return o};var k=function(n){return function(t){var e=Array.prototype.slice.call(arguments,1);t.apply(null,e.concat([function(t){var e=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(t?console.error&&console.error(t):console[n]&&u(e,function(t){console[n](t)}))}]))}};r.log=k("log"),r.dir=k("dir"),r.memoize=function(n,t){var e={},r={};t=t||function(n){return n};var u=function(){var u=Array.prototype.slice.call(arguments),i=u.pop(),c=t.apply(null,u);c in e?i.apply(null,e[c]):c in r?r[c].push(i):(r[c]=[i],n.apply(null,u.concat([function(){e[c]=arguments;var n=r[c];delete r[c];for(var t=0,u=n.length;u>t;t++)n[t].apply(null,arguments)}])))};return u.memo=e,u.unmemoized=n,u},r.unmemoize=function(n){return function(){return(n.unmemoized||n).apply(null,arguments)}},r.times=function(n,t,e){for(var u=[],i=0;n>i;i++)u.push(i);return r.map(u,t,e)},r.timesSeries=function(n,t,e){for(var u=[],i=0;n>i;i++)u.push(i);return r.mapSeries(u,t,e)},r.compose=function(){var n=Array.prototype.reverse.call(arguments);return function(){var t=this,e=Array.prototype.slice.call(arguments),u=e.pop();r.reduce(n,e,function(n,e,r){e.apply(t,n.concat([function(){var n=arguments[0],t=Array.prototype.slice.call(arguments,1);r(n,t)}]))},function(n,e){u.apply(t,[n].concat(e))})}};var A=function(n,t){var e=function(){var e=this,r=Array.prototype.slice.call(arguments),u=r.pop();return n(t,function(n,t){n.apply(e,r.concat([t]))},u)};if(arguments.length>2){var r=Array.prototype.slice.call(arguments,2);return e.apply(this,r)}return e};r.applyEach=l(A),r.applyEachSeries=s(A),r.forever=function(n,t){function e(r){if(r){if(t)return t(r);throw r}n(e)}e()},"undefined"!=typeof define&&define.amd?define([],function(){return r}):"undefined"!=typeof module&&module.exports?module.exports=r:t.async=r}();


}).call(this,require('_process'))
},{"_process":2}],2:[function(require,module,exports){
function drainQueue(){if(!draining){draining=!0;for(var e,o=queue.length;o;){e=queue,queue=[];for(var r=-1;++r<o;)e[r]();o=queue.length}draining=!1}}function noop(){}var process=module.exports={},queue=[],draining=!1;process.nextTick=function(e){queue.push(e),draining||setTimeout(drainQueue,0)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(e){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(e){throw new Error("process.chdir is not supported")},process.umask=function(){return 0};


},{}],3:[function(require,module,exports){
function blur(r,t,a,n){if(!(isNaN(n)||1>n)){n|=0;var e,l,b,f,g,o,u,x,i,s,h,c,v,_,k,m,B,S,w,N,d,p,j,q,y=n+n+1,z=t-1,A=a-1,C=n+1,D=C*(C+1)/2,E=new BlurStack,F=E;for(b=1;y>b;b++)if(F=F.next=new BlurStack,b==C)var G=F;F.next=E;var H=null,I=null;u=o=0;var J=mul_table[n],K=shg_table[n];for(l=0;a>l;l++){for(m=B=S=w=x=i=s=h=0,c=C*(N=r[o]),v=C*(d=r[o+1]),_=C*(p=r[o+2]),k=C*(j=r[o+3]),x+=D*N,i+=D*d,s+=D*p,h+=D*j,F=E,b=0;C>b;b++)F.r=N,F.g=d,F.b=p,F.a=j,F=F.next;for(b=1;C>b;b++)f=o+((b>z?z:b)<<2),x+=(F.r=N=r[f])*(q=C-b),i+=(F.g=d=r[f+1])*q,s+=(F.b=p=r[f+2])*q,h+=(F.a=j=r[f+3])*q,m+=N,B+=d,S+=p,w+=j,F=F.next;for(H=E,I=G,e=0;t>e;e++)r[o+3]=j=h*J>>K,0!=j?(j=255/j,r[o]=(x*J>>K)*j,r[o+1]=(i*J>>K)*j,r[o+2]=(s*J>>K)*j):r[o]=r[o+1]=r[o+2]=0,x-=c,i-=v,s-=_,h-=k,c-=H.r,v-=H.g,_-=H.b,k-=H.a,f=u+((f=e+n+1)<z?f:z)<<2,m+=H.r=r[f],B+=H.g=r[f+1],S+=H.b=r[f+2],w+=H.a=r[f+3],x+=m,i+=B,s+=S,h+=w,H=H.next,c+=N=I.r,v+=d=I.g,_+=p=I.b,k+=j=I.a,m-=N,B-=d,S-=p,w-=j,I=I.next,o+=4;u+=t}for(e=0;t>e;e++){for(B=S=w=m=i=s=h=x=0,o=e<<2,c=C*(N=r[o]),v=C*(d=r[o+1]),_=C*(p=r[o+2]),k=C*(j=r[o+3]),x+=D*N,i+=D*d,s+=D*p,h+=D*j,F=E,b=0;C>b;b++)F.r=N,F.g=d,F.b=p,F.a=j,F=F.next;for(g=t,b=1;n>=b;b++)o=g+e<<2,x+=(F.r=N=r[o])*(q=C-b),i+=(F.g=d=r[o+1])*q,s+=(F.b=p=r[o+2])*q,h+=(F.a=j=r[o+3])*q,m+=N,B+=d,S+=p,w+=j,F=F.next,A>b&&(g+=t);for(o=e,H=E,I=G,l=0;a>l;l++)f=o<<2,r[f+3]=j=h*J>>K,j>0?(j=255/j,r[f]=(x*J>>K)*j,r[f+1]=(i*J>>K)*j,r[f+2]=(s*J>>K)*j):r[f]=r[f+1]=r[f+2]=0,x-=c,i-=v,s-=_,h-=k,c-=H.r,v-=H.g,_-=H.b,k-=H.a,f=e+((f=l+C)<A?f:A)*t<<2,x+=m+=H.r=r[f],i+=B+=H.g=r[f+1],s+=S+=H.b=r[f+2],h+=w+=H.a=r[f+3],H=H.next,c+=N=I.r,v+=d=I.g,_+=p=I.b,k+=j=I.a,m-=N,B-=d,S-=p,w-=j,I=I.next,o+=t}}}function BlurStack(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var mul_table=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],shg_table=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];module.exports=blur;


},{}],4:[function(require,module,exports){
"use strict";function passThrough(e,n){n(null,e)}function processLayers(e){return function(n,r){async.compose(AsyncRenderer.processImage(n.filters),AsyncRenderer.processMask(n.mask),AsyncRenderer.load(e,n))(null,r)}}var async=require("async"),process=require("./process"),CanvasRenderer=require("./canvasrenderer"),AsyncRenderer={};AsyncRenderer.toImage=function(){return function(e,n){n(null,CanvasRenderer.toImage(e))}},AsyncRenderer.load=function(e,n){return n.isPath()?AsyncRenderer.loadFile(n.data):n.isFill()?AsyncRenderer.generateColor(e,n):n.isGradient()?AsyncRenderer.generateGradient(e,n):n.isHtmlCanvas()?AsyncRenderer.loadHtmlCanvas(n.data):n.isImage()?AsyncRenderer.loadImage(n.data):n.isImageCanvas()?AsyncRenderer.loadImageCanvas(n.data):void 0},AsyncRenderer.loadFile=function(e){return function(n,r){var a=document.createElement("canvas"),t=a.getContext("2d"),s=new Image;s.onload=function(){a.width=s.width,a.height=s.height,t.drawImage(s,0,0,a.width,a.height),r(null,a)},s.src=e}},AsyncRenderer.loadHtmlCanvas=function(e){return function(n,r){r(null,e)}},AsyncRenderer.loadImageCanvas=function(e){return function(n,r){e.render(function(e){r(null,e)})}},AsyncRenderer.loadImage=function(e){return function(n,r){var a=CanvasRenderer.loadImage(e);r(null,a)}},AsyncRenderer.generateColor=function(e,n){return function(r,a){var t=CanvasRenderer.generateColor(e,n);a(null,t)}},AsyncRenderer.generateGradient=function(e,n){return function(r,a){var t=CanvasRenderer.generateGradient(e,n);a(null,t)}},AsyncRenderer.processImage=function(e){return 0===e.length?passThrough:function(n,r){CanvasRenderer.processImage(n,e),r(null,n)}},AsyncRenderer.processMask=function(e){return 0===e.layers.length?passThrough:function(n,r){e.width=n.width,e.height=n.height,AsyncRenderer.renderBW(e,function(e){var a=e.getContext("2d").getImageData(0,0,e.width,e.height).data,t={name:"mask",options:{data:a,x:0,y:0,width:e.width,height:e.height}},s=AsyncRenderer.processImage([t]);s(n,r)})}},AsyncRenderer.mergeManualBlend=function(e,n){return function(r,a){CanvasRenderer.mergeManualBlend(e,n)(r),a(null,r)}},AsyncRenderer.mergeNativeBlend=function(e,n){return function(r,a){CanvasRenderer.mergeNativeBlend(e,n)(r),a(null,r)}},AsyncRenderer.merge=function(e,n,r){var a=CanvasRenderer.createRenderPipe(AsyncRenderer,e,n);a.reverse();var t=CanvasRenderer.singleLayerWithOpacity(e,n[0]);a.push(function(e,n){n(null,t)}),async.compose.apply(null,a)(null,function(){r(t)})},AsyncRenderer.composite=function(e,n,r){return n&&0!==n.length?1===n.length?void r(CanvasRenderer.singleLayerWithOpacity(e,n[0])):void AsyncRenderer.merge(e,n,r):void r(null)},AsyncRenderer.render=function(e,n){async.map(e.layers,processLayers(e),function(r,a){n&&AsyncRenderer.composite(e,CanvasRenderer.getLayerData(e,a),n)})},AsyncRenderer.renderBW=function(e,n){AsyncRenderer.render(e,function(e){var r=(e.getContext("2d").getImageData(0,0,e.width,e.height).data,{name:"luminancebw"}),a=AsyncRenderer.processImage([r]);a(e,function(e,r){n(r)})})},module.exports=AsyncRenderer;


},{"./canvasrenderer":6,"./process":8,"async":1}],5:[function(require,module,exports){
"use strict";function addAliases(n){var t,e,i,o=Object.keys(aliases);for(t=0;t<o.length;t+=1)e=o[t],i=aliases[e],n[e]=n[i]}function realBlendMode(n){return void 0!==aliases[n]?aliases[n]:n}function getNativeModes(){var n,t,e,i,o={},r=document.createElement("canvas"),a=r.getContext("2d"),l=["source-over","source-in","source-out","source-atop","destination-over","destination-in","destination-out","destination-atop","lighter","darker","copy","xor"],c=["multiply","screen","overlay","soft-light","hard-light","color-dodge","color-burn","darken","lighten","difference","exclusion","hue","saturation","luminosity","color","add","subtract","average","negation"],d=["divide","darker-color","lighter-color","linear-burn","linear-light","vivid-light","pin-light","hard-mix"];for(n=0;n<l.length;n+=1)o[l[n]]=!0;for(n=0;n<d.length;n+=1)o[d[n]]=!1;for(r.width=1,r.height=1,n=0;n<c.length;n+=1){t=c[n],e="darken"===t,i=!1,a.save();try{a.fillStyle=e?"#300":"#a00",a.fillRect(0,0,1,1),a.globalCompositeOperation=t,a.globalCompositeOperation===t&&(a.fillStyle=e?"#a00":"#300",a.fillRect(0,0,1,1),i=a.getImageData(0,0,1,1).data[0]!==(e?170:51))}catch(u){}a.restore(),o[t]=i}return addAliases(o),o}function _blend(n,t,e,i,o){process(n,t,e,i,o)}function _wrap(n){return function(t,e,i,o,r){r.type=n,_blend(t,e,i,o,r)}}var blend,process,aliases={normal:"source-over","linear-dodge":"add"};process=function(n,t,e,i,o){function r(n,t,e){n/=255,t/=255,e/=255;var i,o,r;return n===t&&t===e?(o=0,i=0):n>=t&&t>=e?(o=n-e,i=60*(t-e)/o):t>n&&n>=e?(o=t-e,i=60*(t-n)/o+60):t>=e&&e>n?(o=t-n,i=60*(e-n)/o+120):e>t&&t>n?(o=e-n,i=60*(e-t)/o+180):e>n&&n>=t?(o=e-t,i=60*(n-t)/o+240):(o=n-t,i=60*(n-e)/o+300),r=V*n+W*t+X*e,[i%360,U(T(o,0),1),U(T(r,0),1)]}function a(n,t,e){n%=360;var i,o,r,a;return n>=0&&60>n?(a=t*n/60,r=e-V*t-W*a,i=r+t,o=r+a):n>=60&&120>n?(a=t*(n-60)/60,o=e+X*t+V*a,r=o-t,i=o-a):n>=120&&180>n?(a=t*(n-120)/60,i=e-W*t-X*a,o=i+t,r=i+a):n>=180&&240>n?(a=t*(n-180)/60,r=e+V*t+W*a,i=r-t,o=r-a):n>=240&&300>n?(a=t*(n-240)/60,o=e-X*t-V*a,r=o+t,i=o+a):(a=t*(n-300)/60,i=e+W*t+X*a,o=i-t,r=i-a),i=255*U(T(i,0),1),o=255*U(T(o,0),1),r=255*U(T(r,0),1),[i,o,r]}function l(){L=I+G-G*F,P=q+H-H*F,Q=z+J-J*F}function c(){L=I*G+I*(1-K)+G*(1-F),P=q*H+q*(1-K)+H*(1-F),Q=z*J+z*(1-K)+J*(1-F)}function d(){L=T(G*F-I*K,0)+I*(1-K)+G*(1-F),P=T(H*F-q*K,0)+q*(1-K)+H*(1-F),Q=T(J*F-z*K,0)+z*(1-K)+J*(1-F)}function u(){L=0===I?0:G/I*255,P=0===q?0:H/q*255,Q=0===z?0:J/z*255}function s(){L=I+G-I*G,P=q+H-q*H,Q=z+J-z*J}function f(){L=T(I*K,G*F)+I*(1-K)+G*(1-F),P=T(q*K,H*F)+q*(1-K)+H*(1-F),Q=T(z*K,J*F)+z*(1-K)+J*(1-F)}function h(){L=U(I*K,G*F)+I*(1-K)+G*(1-F),P=U(q*K,H*F)+q*(1-K)+H*(1-F),Q=U(z*K,J*F)+z*(1-K)+J*(1-F)}function g(){I*K*.3+q*K*.59+z*K*.11>=G*F*.3+H*F*.59+J*F*.11?(L=G*F,P=H*F,Q=J*F):(L=I*K,P=q*K,Q=z*K),L+=I*(1-K)+G*(1-F),P+=q*(1-K)+H*(1-F),Q+=z*(1-K)+J*(1-F)}function v(){G*F*.3+H*F*.59+J*F*.11>I*K*.3+q*K*.59+z*K*.11?(L=G*F,P=H*F,Q=J*F):(L=I*K,P=q*K,Q=z*K),L+=I*(1-K)+G*(1-F),P+=q*(1-K)+H*(1-F),Q+=z*(1-K)+J*(1-F)}function y(){L=U(G+I,255),P=U(H+q,255),Q=U(J+z,255)}function p(){L=G+I,P=H+q,Q=J+z,L=255>L?0:L-255,P=255>P?0:P-255,Q=255>Q?0:Q-255}function b(){L=I+G-2*U(I*K,G*F),P=q+H-2*U(q*K,H*F),Q=z+J-2*U(z*K,J*F)}function m(){L=I*K+G*F-2*I*G+I*(1-K)+G*(1-F),P=q*K+H*F-2*q*H+q*(1-K)+H*(1-F),Q=z*K+J*F-2*z*J+z*(1-K)+J*(1-F)}function x(){L=K>=2*G?2*I*G+I*(1-K)+G*(1-F):I*(1+K)+G*(1+F)-2*G*I-K*F,P=K>=2*H?2*q*H+q*(1-K)+H*(1-F):q*(1+K)+H*(1+F)-2*H*q-K*F,Q=K>=2*J?2*z*J+z*(1-K)+J*(1-F):z*(1+K)+J*(1+F)-2*J*z-K*F}function k(){var n,t=Math.pow;return 0===K?(L=I,P=q,void(Q=z)):(n=G/K,F>=2*I?L=G*(F+(2*I-F)*(1-n))+I*(1-K)+G*(1-F):2*I>F&&K>=4*G?L=K*(2*I-F)*(16*t(n,3)-12*t(n,2)-3*n)+I-I*K+G:2*I>F&&4*G>K&&(L=K*(2*I-F)*(t(n,.5)-n)+I-I*K+G),n=H/K,F>=2*q?P=H*(F+(2*q-F)*(1-n))+q*(1-K)+H*(1-F):2*q>F&&K>=4*H?P=K*(2*q-F)*(16*t(n,3)-12*t(n,2)-3*n)+q-q*K+H:2*q>F&&4*H>K&&(P=K*(2*q-F)*(t(n,.5)-n)+q-q*K+H),n=J/K,void(F>=2*z?Q=J*(F+(2*z-F)*(1-n))+z*(1-K)+J*(1-F):2*z>F&&K>=4*J?Q=K*(2*z-F)*(16*t(n,3)-12*t(n,2)-3*n)+z-z*K+J:2*z>F&&4*J>K&&(Q=K*(2*z-F)*(t(n,.5)-n)+z-z*K+J)))}function w(){L=F>=2*I?2*I*G+I*(1-K)+G*(1-F):I*(1+K)+G*(1+F)-F*K-2*I*G,P=F>=2*q?2*q*H+q*(1-K)+H*(1-F):q*(1+K)+H*(1+F)-F*K-2*q*H,Q=F>=2*z?2*z*J+z*(1-K)+J*(1-F):z*(1+K)+J*(1+F)-F*K-2*z*J}function M(){return 0===K?(L=I,P=q,void(Q=z)):(I===F&&0===G?L=I*(1-K):I===F?L=F*K+I*(1-K)+G*(1-F):F>I&&(L=F*K*U(1,G/K*F/(F-I))+I*(1-K)+G*(1-F)),q===F&&0===H?P=q*(1-K):I===F?P=F*K+q*(1-K)+H*(1-F):F>I&&(P=F*K*U(1,H/K*F/(F-q))+q*(1-K)+H*(1-F)),void(z===F&&0===J?Q=z*(1-K):I===F?Q=F*K+z*(1-K)+J*(1-F):F>I&&(Q=F*K*U(1,J/K*F/(F-z))+z*(1-K)+J*(1-F))))}function _(){return 0===K?(L=I,P=q,void(Q=z)):(0===I&&G===K?L=F*K+G*(1-F):0===I?L=G*(1-F):I>0&&(L=F*K*(1-U(1,(1-G/K)*F/I))+I*(1-K)+G*(1-F)),0===q&&H===K?P=F*K+H*(1-F):0===q?P=H*(1-F):q>0&&(P=F*K*(1-U(1,(1-H/K)*F/q))+q*(1-K)+H*(1-F)),void(0===z&&J===K?Q=F*K+J*(1-F):0===z?Q=J*(1-F):z>0&&(Q=F*K*(1-U(1,(1-J/K)*F/z))+z*(1-K)+J*(1-F))))}function O(){var n=2*I+G-256,t=2*q+H-256,e=2*z+J-256;L=0>n||128>I&&0>n?0:n>255?255:n,P=0>t||128>q&&0>t?0:t>255?255:t,Q=0>e||128>z&&0>e?0:e>255?255:e}function A(){var n;128>I?I?(n=255-(255-G<<8)/(2*I),L=0>n?0:n):L=0:(n=2*I-256,255>n?(n=(G<<8)/(255-n),L=n>255?255:n):L=0>n?0:n),128>q?q?(n=255-(255-H<<8)/(2*q),P=0>n?0:n):P=0:(n=2*q-256,255>n?(n=(H<<8)/(255-n),P=n>255?255:n):P=0>n?0:n),128>z?z?(n=255-(255-J<<8)/(2*z),Q=0>n?0:n):Q=0:(n=2*z-256,255>n?(n=(J<<8)/(255-n),Q=n>255?255:n):Q=0>n?0:n)}function B(){var n;128>I?(n=2*I,L=n>G?G:n):(n=2*I-256,L=G>n?G:n),128>q?(n=2*q,P=n>H?H:n):(n=2*q-256,P=H>n?H:n),128>z?(n=2*z,Q=n>J?J:n):(n=2*z-256,Q=J>n?J:n)}function C(){var n;128>I?L=128>255-(255-G<<8)/(2*I)||0===I?0:255:(n=2*I-256,L=255>n&&128>(G<<8)/(255-n)?0:255),128>q?P=128>255-(255-H<<8)/(2*q)||0===q?0:255:(n=2*q-256,P=255>n&&128>(H<<8)/(255-n)?0:255),128>z?Q=128>255-(255-J<<8)/(2*z)||0===z?0:255:(n=2*z-256,Q=255>n&&128>(J<<8)/(255-n)?0:255)}function N(){var n=r(G,H,J),t=r(I,q,z),e=a(t[0],n[1],n[2]);L=e[0],P=e[1],Q=e[2]}function j(){var n=r(G,H,J),t=r(I,q,z),e=a(n[0],t[1],n[2]);L=e[0],P=e[1],Q=e[2]}function R(){var n=r(G,H,J),t=r(I,q,z),e=a(n[0],n[1],t[2]);L=e[0],P=e[1],Q=e[2]}function S(){var n=r(G,H,J),t=r(I,q,z),e=a(t[0],t[1],n[2]);L=e[0],P=e[1],Q=e[2]}function D(n,t){var e=n.x+n.width,i=n.y+n.height,o=t.x+t.width,r=t.y+t.height,a=T(n.x,t.x),l=T(n.y,t.y),c=T(U(e,o)-a,0),d=T(U(i,r)-l,0);return[a,l,c,d]}var E,I,q,z,F,G,H,J,K,L,P,Q,T=Math.max,U=Math.min,V=.2126,W=.7152,X=.0722;E={"source-over":l,multiply:c,subtract:d,divide:u,screen:s,lighten:f,darken:h,"darker-color":g,"lighter-color":v,add:y,"linear-burn":p,difference:b,exclusion:m,overlay:x,"soft-light":k,"hard-light":w,"color-dodge":M,"color-burn":_,"linear-light":O,"vivid-light":A,"pin-light":B,"hard-mix":C,hue:N,saturation:j,luminosity:R,color:S},function(){function r(){F=y[c+3]/255*p,K=n[l+3]/255,h=F+K-F*K,g=255/h,I=y[c]/255*F,q=y[c+1]/255*F,z=y[c+2]/255*F,G=n[l]/255*K,H=n[l+1]/255*K,J=n[l+2]/255*K,b(),t[l]=L*g,t[l+1]=P*g,t[l+2]=Q*g,t[l+3]=255*h}function a(){G=n[l],H=n[l+1],J=n[l+2],I=y[c],q=y[c+1],z=y[c+2],b(),t[l]=L,t[l+1]=P,t[l+2]=Q,t[l+3]=n[l+3],s=p*y[c+3]/255,1>s&&(f=1-s,t[l]=n[l]*f+t[l]*s,t[l+1]=n[l+1]*f+t[l+1]*s,t[l+2]=n[l+2]*f+t[l+2]*s)}var l,c,d,u,s,f,h,g,v,y=o.data,p=0===o.opacity?0:o.opacity||1,b=E[o.type||"_svg_normal"],m=o.dx||0,x=o.dy||0,k=D({x:0,y:0,width:e,height:i},{x:m,y:x,width:o.width,height:o.height}),w=k[0],M=k[1],_=k[2],O=k[3];for(v=0===b.name.indexOf("_svg_")?r:a,u=0;i>u;u+=1)for(d=0;e>d;d+=1)l=4*(u*e+d),u>=M&&d>=w&&w+_>d&&M+O>u?(c=4*((u-x)*o.width+d-m),v()):(t[l]=n[l],t[l+1]=n[l+1],t[l+2]=n[l+2],t[l+3]=n[l+3])}()},blend=function(){for(var n,t={blend:_blend},e=["source-over","add","multiply","subtract","divide","screen","lighten","darken","darker-color","lighter-color","linear-burn","difference","exclusion","overlay","soft-light","hard-light","color-dodge","color-burn","linear-light","vivid-light","pin-light","hard-mix","hue","saturation","luminosity","color"],i=0;i<e.length;i+=1)n=e[i],t[n]=_wrap(n);for(e=Object.keys(e),i=0;i<e.length;i+=1);return addAliases(t),t.getNativeModes=getNativeModes,t.realBlendMode=realBlendMode,t}(),module.exports=blend;


},{}],6:[function(require,module,exports){
"use strict";function createImageData(e,a,t){return e.createImageData?e.createImageData(a,t):e.getImageData(0,0,a,t)}function transformLayer(e,a,t){var r=t.transform.matrix();e.translate(a.width/2,a.height/2),e.transform(r[0],r[1],r[3],r[4],r[6],r[7]),(t.flip_h||t.flip_v)&&e.scale(t.flip_h?-1:1,t.flip_v?-1:1),e.translate(-t.img.width/2,-t.img.height/2)}function transformRect(e,a){var t,r,n,i,d,h=a.img.width,o=a.img.height,s={x:0,y:0},g={x:h,y:0},l={x:0,y:o},m={x:h,y:o},c=[s,g,l,m],v=util.transform();v=v.translate(e.width/2,e.height/2),v=v.append(a.transform),v=v.translate(-a.img.width/2,-a.img.height/2);for(var u=0;4>u;u+=1)t=v.transformPoint(c[u]),0===u?(r=i=t.x,n=d=t.y):(t.x<r&&(r=t.x),t.x>i&&(i=t.x),t.y<n&&(n=t.y),t.y>d&&(d=t.y));return{x:r,y:n,width:i-r,height:d-n}}function rectIntersect(e,a){var t=e.x+e.width,r=e.y+e.height,n=a.x+a.width,i=a.y+a.height,d=Math.max(e.x,a.x),h=Math.max(e.y,a.y),o=Math.max(Math.min(t,n)-d,0),s=Math.max(Math.min(r,i)-h,0);return{x:d,y:h,width:o,height:s}}function calcLayerRect(e,a){var t=transformRect(e,a);return t=rectIntersect(t,{x:0,y:0,width:e.width,height:e.height}),{x:Math.round(t.x),y:Math.round(t.y),width:Math.ceil(t.width),height:Math.ceil(t.height)}}function getTransformedLayerData(e,a,t){var r=document.createElement("canvas"),n=r.getContext("2d");return r.width=t.width,r.height=t.height,n.translate(-t.x,-t.y),transformLayer(n,e,a),n.drawImage(a.img,0,0),n.getImageData(0,0,t.width,t.height)}var blend=require("./blend"),process=require("./process"),util=require("./util"),nativeBlendModes=blend.getNativeModes(),CanvasRenderer={};CanvasRenderer.toImage=function(e){var a=new Image;return a.width=e.width,a.height=e.height,a.src=e.toDataURL(),a},CanvasRenderer.load=function(e,a){return a.isFill()?CanvasRenderer.generateColor(e,a):a.isGradient()?CanvasRenderer.generateGradient(e,a):a.isHtmlCanvas()?CanvasRenderer.loadHtmlCanvas(a.data):a.isImage()?CanvasRenderer.loadImage(a.data):a.isImageCanvas()?CanvasRenderer.loadImageCanvas(a.data):void 0},CanvasRenderer.loadHtmlCanvas=function(e){return e},CanvasRenderer.loadImageCanvas=function(e){return e.render()},CanvasRenderer.loadImage=function(e){var a=document.createElement("canvas"),t=a.getContext("2d");return a.width=e.width,a.height=e.height,t.drawImage(e,0,0,a.width,a.height),a},CanvasRenderer.generateColor=function(e,a){var t=void 0!==a.width?a.width:e.width,r=void 0!==a.height?a.height:e.height,n=document.createElement("canvas"),i=n.getContext("2d");return n.width=t,n.height=r,i.fillStyle=a.data,i.fillRect(0,0,t,r),n},CanvasRenderer.generateGradient=function(e,a){var t,r,n,i,d,h=void 0!==a.width?a.width:e.width,o=void 0!==a.height?a.height:e.height,s=h/2,g=o/2,l=document.createElement("canvas"),m=l.getContext("2d"),c=a.data,v=c.type||"linear",u=c.rotation||0;return"radial"===v?t=m.createRadialGradient(s,g,0,s,g,Math.min(h,o)/2):(0>u&&(u+=360),u>=0&&45>u?(r=0,n=o/2*(45-u)/45,i=h,d=o-n):u>=45&&135>u?(r=h*(u-45)/90,n=0,i=h-r,d=o):u>=135&&225>u?(r=h,n=o*(u-135)/90,i=0,d=o-n):u>=225&&315>u?(r=h*(1-(u-225)/90),n=o,i=h-r,d=0):u>=315&&(r=0,n=o-o/2*(u-315)/45,i=h,d=o-n),t=m.createLinearGradient(r,n,i,d)),t.addColorStop(c.spread||0,c.startColor),t.addColorStop(1,c.endColor),l.width=h,l.height=o,m.fillStyle=t,m.fillRect(0,0,h,o),l},CanvasRenderer.processImage=function(e,a){if(0===a.length)return e;for(var t,r,n=e.getContext("2d"),i=e.width,d=e.height,h=n.getImageData(0,0,i,d),o=createImageData(n,i,d),s=0;s<a.length;s+=1)s>0&&(r=h,h=o,o=r),t=a[s],process[t.name](h.data,o.data,i,d,t.options);return n.putImageData(o,0,0),e},CanvasRenderer.processMask=function(e,a){if(0===a.layers.length)return e;a.width=e.width,a.height=e.height;var t=CanvasRenderer.renderBW(a),r=t.getContext("2d").getImageData(0,0,t.width,t.height).data,n={name:"mask",options:{data:r,x:0,y:0,width:t.width,height:t.height}};return CanvasRenderer.processImage(e,[n])},CanvasRenderer.processLayer=function(e,a){var t=CanvasRenderer.load(e,a),r=CanvasRenderer.processMask(t,a.mask);return CanvasRenderer.processImage(r,a.filters)},CanvasRenderer.mergeManualBlend=function(e,a){return function(t){for(var r,n,i,d,h,o,s=t.getContext("2d"),g=e.width,l=e.height,m=s.getImageData(0,0,g,l),c=createImageData(s,g,l),v=0;v<a.length;v+=1)if(r=a[v],o=calcLayerRect(e,r),o.width>0&&o.height>0){if(v>0&&(d=m,m=c,c=d),i=getTransformedLayerData(e,r,o),h={data:i.data,width:o.width,height:o.height,opacity:r.opacity,dx:o.x,dy:o.y},void 0===blend[r.blendmode])throw new Error("No blend mode named '"+r.blendmode+"'");n=blend.realBlendMode(r.blendmode),blend[n](m.data,c.data,g,l,h)}return s.putImageData(c,0,0),t}},CanvasRenderer.singleLayerWithOpacity=function(e,a){var t=document.createElement("canvas"),r=t.getContext("2d");return t.width=e.width,t.height=e.height,r.save(),transformLayer(r,e,a),1!==a.opacity&&(r.globalAlpha=a.opacity),r.drawImage(a.img,0,0),r.restore(),t},CanvasRenderer.mergeNativeBlend=function(e,a){return function(t){for(var r,n=t.getContext("2d"),i=0;i<a.length;i+=1)r=a[i],n.save(),transformLayer(n,e,r),1!==r.opacity&&(n.globalAlpha=r.opacity),"source-over"!==r.blendmode&&(n.globalCompositeOperation=blend.realBlendMode(r.blendmode)),n.drawImage(r.img,0,0),n.restore();return t}},CanvasRenderer.createRenderPipe=function(e,a,t){function r(){if(void 0!==i){var t=i?e.mergeNativeBlend:e.mergeManualBlend;o.push(t(a,d))}}for(var n,i,d,h,o=[],s=1;s<t.length;s+=1)h=t[s],n=h.blendmode,(void 0===i||i!==nativeBlendModes[n])&&(r(),d=[]),d.push(h),i=nativeBlendModes[n],s===t.length-1&&r();return o},CanvasRenderer.merge=function(e,a){for(var t=CanvasRenderer.createRenderPipe(CanvasRenderer,e,a),r=CanvasRenderer.singleLayerWithOpacity(e,a[0]),n=0;n<t.length;n+=1)r=t[n](r);return r},CanvasRenderer.composite=function(e,a){return a&&0!==a.length?1===a.length?CanvasRenderer.singleLayerWithOpacity(e,a[0]):CanvasRenderer.merge(e,a):null},CanvasRenderer.getLayerData=function(e,a){for(var t,r,n,i=[],d=0;d<a.length;d+=1)r=e.layers[d],n=a[d],t={img:n,opacity:r.opacity,blendmode:r.blendmode,transform:r.transform,flip_h:r.flip_h,flip_v:r.flip_v},i.push(t);return i},CanvasRenderer.render=function(e){for(var a=[],t=0;t<e.layers.length;t+=1)a.push(CanvasRenderer.processLayer(e,e.layers[t]));return CanvasRenderer.composite(e,CanvasRenderer.getLayerData(e,a))},CanvasRenderer.renderBW=function(e){var a=CanvasRenderer.render(e),t=(a.getContext("2d").getImageData(0,0,a.width,a.height).data,{name:"luminancebw"});return CanvasRenderer.processImage(a,[t])},module.exports=CanvasRenderer;


},{"./blend":5,"./process":8,"./util":9}],7:[function(require,module,exports){
"use strict";function toColor(t,r,e,a,n){var i,o,s,h,l,g,u,m;if(void 0===t)i=o=s=0,h=1;else if(Array.isArray(t))m=r||{},i=void 0!==t[0]?t[0]:0,o=void 0!==t[1]?t[1]:0,s=void 0!==t[2]?t[2]:0,h=void 0!==t[3]?t[3]:m.base||1;else if(void 0!==t.r)m=r||{},i=t.r,o=t.g,s=t.b,h=void 0!==t.a?t.a:m.base||1;else if("string"==typeof t){if(0===t.indexOf("#"))return t;if(0===t.indexOf("rgb"))return t;if(-1!==colors.indexOf(t))return t}else"number"==typeof t&&(1===arguments.length?(i=o=s=t,h=1):2===arguments.length?(i=o=s=t,"number"==typeof r?h=r:(m=r,h=m.base||1)):3===arguments.length?"number"==typeof e?(i=t,o=r,s=e,h=1):(i=o=s=t,h=r,m=e):4===arguments.length?(i=t,o=r,s=e,"number"==typeof a?h=a:(m=a||{},h=m.base||1)):(i=t,o=r,s=e,h=a,m=n));if("number"!=typeof i||"number"!=typeof o||"number"!=typeof s||"number"!=typeof h)throw new Error("Invalid color arguments");return m=m||{},void 0!==m.base&&(i/=m.base,o/=m.base,s/=m.base,h/=m.base),l=Math.round(255*i),g=Math.round(255*o),u=Math.round(255*s),"rgba("+l+", "+g+", "+u+", "+h+")"}function toGradientData(t,r,e,a,n){var i,o,s,h,l,g,u={};if(1===arguments.length)g=t||{},i=g.startColor,o=g.endColor,s=g.type,h=g.rotation,l=g.spread;else if(arguments.length>=2)if(i=t,o=r,s="linear",h=0,l=0,3===arguments.length)"string"==typeof e?s=e:"number"==typeof e&&(h=e);else if(4===arguments.length)if("number"==typeof e)h=e,l=a;else if("linear"===e)h=a;else{if("radial"!==e)throw new Error("Wrong argument provided: "+e);s=e,l=a}else 5===arguments.length&&(s=e,h=a,l=n);if(!i&&0!==i)throw new Error("No startColor was given.");if(!o&&0!==o)throw new Error("No endColor was given.");try{u.startColor=toColor(i)}catch(m){throw new Error("startColor is not a valid color: "+i)}try{u.endColor=toColor(o)}catch(d){throw new Error("endColor is not a valid color: "+o)}if(void 0===s&&(s="linear"),"linear"!==s&&"radial"!==s)throw new Error("Unknown gradient type: "+s);if(u.type=s,void 0===l&&(l=0),"number"!=typeof l)throw new Error("Spread value is not a number: "+l);if("linear"===s){if(void 0===h&&(h=0),"number"!=typeof h)throw new Error("Rotation value is not a number: "+h);u.rotation=h}return u.spread=clamp(l,0,.99),u}function findType(t){if("string"==typeof t)return TYPE_PATH;if(t instanceof Image)return TYPE_IMAGE;if(t instanceof HTMLCanvasElement)return TYPE_HTML_CANVAS;if(t instanceof ImageCanvas)return TYPE_IMAGE_CANVAS;if(void 0!==t.r&&void 0!==t.g&&void 0!==t.b&&void 0!==t.a)return TYPE_FILL;if(void 0!==t.startColor&&void 0!==t.endColor)return TYPE_GRADIENT;throw new Error("Cannot establish type for data ",t)}function isPoint(t){return t?void 0!==t.x&&void 0!==t.y:!1}function pointFromArray(t){var r=t[0],e=t.length>1?t[1]:r;return{x:r,y:e}}function pointFromNumber(t){return{x:t,y:t}}function isValidArg(t){return void 0!==t&&null!==t}function convertArg(t){return Array.isArray(t)?pointFromArray(t):"number"==typeof t?pointFromNumber(t):isPoint(t)?t:void 0}function loadImage(t,r){var e=new Image;e.onload=function(){r(null,[t,this])},e.src=t}function loadImages(t,r){async.map(t,loadImage,function(t,e){if(r){for(var a,n,i={},o=0;o<e.length;o+=1)a=e[o][0],n=e[o][1],i[a]=n;r(i)}})}function merge(t){var r,e,a,n;for(r=0;r<t.length;r+=1)e=t[r],a=0===r?e.bounds():a.unite(e.bounds());var i=a.width/2+a.x,o=a.height/2+a.y,s=new ImageCanvas(a.width,a.height);for(r=0;r<t.length;r+=1)n=s.addLayer(t[r].toLayer()),n.translate(-i,-o);return new Img(s.render(),i,o)}var util=require("./util"),CanvasRenderer=require("./canvasrenderer"),AsyncRenderer=require("./asyncrenderer"),img,ImageCanvas,Layer,Img,DEFAULT_WIDTH=800,DEFAULT_HEIGHT=800,TYPE_PATH="path",TYPE_IMAGE="image",TYPE_HTML_CANVAS="htmlCanvas",TYPE_IMAGE_CANVAS="iCanvas",TYPE_FILL="fill",TYPE_GRADIENT="gradient",IDENTITY_TRANSFORM=util.transform(),Transform=IDENTITY_TRANSFORM,clamp=util.clamp,colors=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","transparent","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"];Layer=function(t,r){r||(r=findType(t)),this.data=t,this.type=r,(r===TYPE_HTML_CANVAS||r===TYPE_IMAGE_CANVAS||r===TYPE_IMAGE)&&(this.width=t.width,this.height=t.height),this.opacity=1,this.blendmode="source-over",this.transform=IDENTITY_TRANSFORM,this.flip_h=!1,this.flip_v=!1,this.mask=new ImageCanvas,this.filters=[]},Layer.Transform=Layer.IDENTITY_TRANSFORM=IDENTITY_TRANSFORM,Layer.prototype.clone=function(){function t(t){var r,e,a={};if(a.name=t.name,void 0!==t.options){a.options={};for(var n=Object.keys(t.options),i=0;i<n.length;i+=1)r=n[i],e=t.options[r],Array.isArray(e)?a.options[r]=e.slice(0):a.options[r]=e}return a}var r={data:this.data,type:this.type,width:this.width,height:this.height,opacity:this.opacity,blendmode:this.blendmode,transform:this.transform,flip_h:this.flip_h,flip_v:this.flip_v,mask:this.mask.clone(),filters:[]};this.type===TYPE_IMAGE_CANVAS?r.data=this.data.clone():this.type===TYPE_GRADIENT&&(r.data={startColor:this.data.startColor,endColor:this.data.endColor,type:this.data.type,rotation:this.data.rotation,spread:this.data.spread});for(var e=0;e<this.filters.length;e+=1)r.filters.push(t(this.filters[e]));return r.__proto__=this.__proto__,r},Layer.prototype.setOpacity=function(t){this.opacity=clamp(t,0,1)},Layer.prototype.translate=function(t,r){r=void 0===r?0:r;var e=Transform.translate(t,r);this.transform=this.transform.prepend(e)},Layer.prototype.scale=function(t,r){r=void 0===r?t:r;var e=Transform.scale(t,r);this.transform=this.transform.prepend(e)},Layer.prototype.rotate=function(t){var r=Transform.rotate(t);this.transform=this.transform.prepend(r)},Layer.prototype.skew=function(t,r){r=void 0===r?t:r;var e=Transform.skew(t,r);this.transform=this.transform.prepend(e)},Layer.prototype.flipHorizontal=function(t){void 0!==t?this.flip_h=t:this.flip_h=!this.flip_h},Layer.prototype.flipVertical=function(t){void 0!==t?this.flip_v=t:this.flip_v=!this.flip_v},Layer.prototype.addFilter=function(t,r){this.filters.push({name:t,options:r})},Layer.prototype.draw=function(t){var r=void 0===this.width?DEFAULT_WIDTH:this.width,e=void 0===this.height?DEFAULT_HEIGHT:this.height,a=new ImageCanvas(r,e);a.addLayer(this),a.draw(t)},Layer.prototype.toCanvas=function(){var t=document.createElement("canvas");t.width=this.width,t.height=this.height;var r=t.getContext("2d");return this.draw(r),t},Layer.fromFile=function(t){return new Layer(t,TYPE_PATH)},Layer.fromImage=function(t){return new Layer(t,TYPE_IMAGE)},Layer.fromCanvas=function(t){return t instanceof HTMLCanvasElement?Layer.fromHtmlCanvas(t):Layer.fromImageCanvas(t)},Layer.fromHtmlCanvas=function(t){return new Layer(t,TYPE_HTML_CANVAS)},Layer.fromImageCanvas=function(t){return new Layer(t,TYPE_IMAGE_CANVAS)},Layer.fromColor=function(t){return new Layer(toColor(t),TYPE_FILL)},Layer.fromGradient=function(){return new Layer(toGradientData.apply(null,arguments),TYPE_GRADIENT)},Layer.prototype.isPath=function(){return this.type===TYPE_PATH},Layer.prototype.isFill=function(){return this.type===TYPE_FILL},Layer.prototype.isGradient=function(){return this.type===TYPE_GRADIENT},Layer.prototype.isHtmlCanvas=function(){return this.type===TYPE_HTML_CANVAS},Layer.prototype.isImage=function(){return this.type===TYPE_IMAGE},Layer.prototype.isImageCanvas=function(){return this.type===TYPE_IMAGE_CANVAS};var Pixels=function(t){this.width=t.width,this.height=t.height;var r=t.getContext("2d");this._data=r.getImageData(0,0,this.width,this.height),this.array=this._data.data};Pixels.prototype.get=function(t){t*=4;var r=this.array;return[r[t+0],r[t+1],r[t+2],r[t+3]]},Pixels.prototype.set=function(t,r){t*=4;var e=this.array;e[t+0]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3]},Pixels.prototype.toCanvas=function(){var t=document.createElement("canvas");t.width=this.width,t.height=this.height;var r=t.getContext("2d");return r.putImageData(this._data,0,0),t},ImageCanvas=function(t,r){t||(t=DEFAULT_WIDTH),r||(r=DEFAULT_HEIGHT),this.width=t,this.height=r,this.layers=[]},ImageCanvas.prototype.clone=function(){for(var t=new ImageCanvas(this.width,this.height),r=0;r<this.layers.length;r+=1)t.layers.push(this.layers[r].clone());return t},ImageCanvas.prototype.addLayer=function(t){var r;try{return this.addGradientLayer.apply(this,arguments)}catch(e){}try{return this.addColorLayer.apply(this,arguments)}catch(a){}if(1===arguments.length&&("string"==typeof t?r=new Layer(t,TYPE_PATH):t instanceof Layer?r=t:t instanceof HTMLCanvasElement?r=new Layer(t,TYPE_HTML_CANVAS):t instanceof Image?r=new Layer(t,TYPE_IMAGE):t instanceof ImageCanvas&&(r=new Layer(t,TYPE_IMAGE_CANVAS))),!r)throw new Error("Error creating layer.");return this.layers.push(r),r},ImageCanvas.prototype.addColorLayer=function(){var t=toColor.apply(null,arguments),r=new Layer(t,TYPE_FILL);return this.layers.push(r),r},ImageCanvas.prototype.addGradientLayer=function(){var t=toGradientData.apply(null,arguments),r=new Layer(t,TYPE_GRADIENT);return this.layers.push(r),r},ImageCanvas.prototype.render=function(t){var r=t?AsyncRenderer:CanvasRenderer;return r.render(this,t)},ImageCanvas.prototype.draw=function(t,r){if(r)this.render(function(r){t.drawImage(r,0,0,r.width,r.height)});else{var e=this.render();t.drawImage(e,0,0,e.width,e.height)}},Img=function(t,r,e){this.canvas=t,this.originalWidth=t?t.width:0,this.originalHeight=t?t.height:0,this.transform=r||e?Transform.translate(r,e):Layer.IDENTITY_TRANSFORM},Img.prototype.clone=function(){var t=new Img;return t.canvas=this.canvas,t.originalWidth=this.originalWidth,t.originalHeight=this.originalHeight,t.transform=this.transform,t},Img.prototype.withCanvas=function(t){var r=this.clone();return r.canvas=t,r},Img.prototype._transform=function(t){var r=this.clone();return r.transform=r.transform.prepend(t),r},Img.prototype.translate=function(t){var r=pointFromNumber(0),e=arguments;return 1===e.length&&isValidArg(t)?r=convertArg(t):2===e.length&&(r={x:e[0],y:e[1]}),0===r.x&&0===r.y?this:this._transform(Transform.translate(r.x,r.y))},Img.prototype.rotate=function(t){if(!t)return this;var r=pointFromNumber(0),e=arguments;return 2===e.length?r=convertArg(e[1]):3===e.length&&(r={x:e[1],y:e[2]}),this._transform(Transform.translate(r.x,r.y).rotate(t).translate(-r.x,-r.y))},Img.prototype.scale=function(t){var r=pointFromNumber(100),e=pointFromNumber(0),a=arguments;return 1===a.length&&isValidArg(t)?r=convertArg(t):2===a.length?"number"==typeof t&&"number"==typeof a[1]?r={x:a[0],y:a[1]}:(r=convertArg(t),e=convertArg(a[1])):4===a.length&&(r={x:a[0],y:a[1]},e={x:a[2],y:a[3]}),100===r.x&&100===r.y?this:this._transform(Transform.translate(e.x,e.y).scale(r.x/100,r.y/100).translate(-e.x,-e.y))},Img.prototype.skew=function(t){var r=pointFromNumber(0),e=pointFromNumber(0),a=arguments;return 1===a.length&&isValidArg(t)?r=convertArg(t):2===a.length?"number"==typeof t&&"number"==typeof a[1]?r={x:a[0],y:a[1]}:(r=convertArg(t),e=convertArg(a[1])):4===a.length&&(r={x:a[0],y:a[1]},e={x:a[2],y:a[3]}),0===r.x&&0===r.y?this:this._transform(Transform.translate(e.x,e.y).skew(r.x,r.y).translate(-e.x,-e.y))},Img.prototype.transformed=function(){return img.merge([this])},Img.prototype.bounds=function(){for(var t,r,e,a,n,i=this.transform,o=this.originalWidth/2,s=this.originalHeight/2,h={x:-o,y:-s},l={x:o,y:-s},g={x:-o,y:s},u={x:o,y:s},m=[h,l,g,u],d=0;4>d;d+=1)t=i.transformPoint(m[d]),0===d?(r=a=t.x,e=n=t.y):(t.x<r&&(r=t.x),t.x>a&&(a=t.x),t.y<e&&(e=t.y),t.y>n&&(n=t.y));return{x:r,y:e,width:a-r,height:n-e}},Img.prototype.colorize=function(t){var r=Layer.fromColor(t);r.width=this.originalWidth,r.height=this.originalHeight;var e=new Img(r.toCanvas());return e=e._transform(this.transform.matrix()),img.merge([this,e])},Img.prototype.desaturate=function(){var t=this.toLayer(!1);return t.addFilter("desaturate"),this.withCanvas(t.toCanvas())},Img.prototype.crop=function(t){function r(t,r){var e=t.x+t.width,a=t.y+t.height,n=r.x+r.width,i=r.y+r.height,o=Math.max(t.x,r.x),s=Math.max(t.y,r.y),h=Math.max(Math.min(e,n)-o,0),l=Math.max(Math.min(a,i)-s,0);return{x:o,y:s,width:h,height:l}}var e=this.bounds(),a=t.bounds(),n=r(e,a),i=Math.ceil(n.width),o=Math.ceil(n.height);if(0===n.width||0===n.height)throw new Error("Resulting image has no dimensions");var s=new img.ImageCanvas(i,o),h=s.addLayer(this.toLayer());return h.translate(i/2-a.width-a.x,o/2-a.height-a.y),i<a.width&&n.x>e.x&&h.translate(a.width-i,0),o<a.height&&n.y>e.y&&h.translate(0,a.height-o),new Img(s.render(),n.x+i/2,n.y+o/2)},Img.prototype.draw=function(t){t.save();var r=this.transform.matrix();t.transform(r[0],r[1],r[3],r[4],r[6],r[7]),t.translate(-this.originalWidth/2,-this.originalHeight/2),t.drawImage(this.canvas,0,0),t.restore()},Img.prototype.toLayer=function(t){var r=document.createElement("canvas");r.width=this.canvas.width,r.height=this.canvas.height;var e=r.getContext("2d");e.drawImage(this.canvas,0,0);var a=img.Layer.fromHtmlCanvas(r);return void 0===t&&(t=!0),t&&(a.transform=this.transform),a},Img.prototype.getPixels=function(){return new Pixels(this.canvas)},Img.prototype.toImage=function(){var t=this.bounds(),r=this.crop({bounds:function(){return t}}),e=new Image;return e.width=r.canvas.width,e.height=r.canvas.height,e.src=r.canvas.toDataURL(),e},img={},img.Layer=Layer,img.ImageCanvas=ImageCanvas,img.Img=Img,img.Pixels=Pixels;var async=require("async");img.loadImages=loadImages,img.merge=merge,module.exports=img;
},{"./asyncrenderer":4,"./canvasrenderer":6,"./util":9,"async":1}],8:[function(require,module,exports){
"use strict";function defaultOptions(o,n){if(!o)return n;var t,r={};for(t in n)n.hasOwnProperty(t)&&("undefined"==typeof o[t]?r[t]=n[t]:r[t]=o[t]);return r}function smoothstep(o,n,t){return o>t?0:t>=n?1:(t=(t-o)/(n-o),t*t*(3-2*t))}function noise(){return.5*Math.random()+.5}function colorDistance(o,n,t){return clamp(o*n+(1-o)*t,0,255)}function convolve3x3(o,n,t,r,a,e,i,u){var f,c,l,s,v,p,d,m,h,x,g,O,M,b,y,z,k,w,P,q,S,A,j=a[0][0],D=a[0][1],I=a[0][2],B=a[1][0],C=a[1][1],E=a[1][2],F=a[2][0],G=a[2][1],H=a[2][2];for(c=0;r>c;c+=1)for(m=c*t*4,h=m-4*t,x=m+4*t,1>c&&(h=m),c>=t-1&&(x=m),f=0;t>f;f+=1)l=4*(c*t+f),g=4*f,O=g-4,M=g+4,1>f&&(O=g),f>=t-1&&(M=g),b=h+O,y=h+g,z=h+M,k=m+O,w=m+g,P=m+M,q=x+O,S=x+g,A=x+M,s=o[b]*j+o[y]*D+o[z]*I+o[k]*B+o[w]*C+o[P]*E+o[q]*F+o[S]*G+o[A]*H,v=o[b+1]*j+o[y+1]*D+o[z+1]*I+o[k+1]*B+o[w+1]*C+o[P+1]*E+o[q+1]*F+o[S+1]*G+o[A+1]*H,p=o[b+2]*j+o[y+2]*D+o[z+2]*I+o[k+2]*B+o[w+2]*C+o[P+2]*E+o[q+2]*F+o[S+2]*G+o[A+2]*H,d=e?o[b+3]*j+o[y+3]*D+o[z+3]*I+o[k+3]*B+o[w+3]*C+o[P+3]*E+o[q+3]*F+o[S+3]*G+o[A+3]*H:o[l+3],u&&(s=v=p=(s+v+p)/3),i&&(s=255-s,v=255-v,p=255-p),n[l]=s,n[l+1]=v,n[l+2]=p,n[l+3]=d}function convolve5x5(o,n,t,r,a,e,i,u){var f,c,l,s,v,p,d,m,h,x,g,O,M,b,y,z,k,w,P,q,S,A,j,D,I,B,C,E,F,G,H,J,K,L,N,Q,R,T,U,V,W,X,Y=a[0][0],Z=a[0][1],$=a[0][2],_=(a[0][3],a[0][4]),oo=a[1][0],no=a[1][1],to=a[1][2],ro=(a[1][3],a[1][4]),ao=a[2][0],eo=a[2][1],io=a[2][2],uo=(a[2][3],a[2][4]),fo=a[3][0],co=a[3][1],lo=a[3][2],so=(a[3][3],a[3][4]),vo=a[4][0],po=a[4][1],mo=a[4][2],ho=(a[4][3],a[4][4]);for(c=0;r>c;c+=1)for(m=c*t*4,h=m-4*t,g=m-4*t*2,x=m+4*t,O=m+4*t*2,1>c&&(h=m),c>=t-1&&(x=m),2>c&&(g=h),c>=t-2&&(O=x),f=0;t>f;f+=1)l=4*(c*t+f),M=4*f,b=M-4,y=M+4,z=M-8,k=M+8,1>f&&(b=M),f>=t-1&&(y=M),2>f&&(z=b),f>=t-2&&(k=y),w=g+z,P=g+b,q=g+M,S=g+y,A=g+k,j=h+z,D=h+b,I=h+M,B=h+y,C=h+k,E=m+z,F=m+b,G=m+M,H=m+y,J=m+k,K=x+z,L=x+b,N=x+M,Q=x+y,R=x+k,T=O+z,U=O+b,V=O+M,W=O+y,X=O+k,s=o[w]*Y+o[P]*Z+o[q]*$+o[S]*_+o[q]*_+o[j]*oo+o[D]*no+o[I]*to+o[B]*ro+o[I]*ro+o[E]*ao+o[F]*eo+o[G]*io+o[H]*uo+o[G]*uo+o[K]*fo+o[L]*co+o[N]*lo+o[Q]*so+o[N]*so+o[T]*vo+o[U]*po+o[V]*mo+o[W]*ho+o[V]*ho,v=o[w+1]*Y+o[P+1]*Z+o[q+1]*$+o[S+1]*_+o[q+1]*_+o[j+1]*oo+o[D+1]*no+o[I+1]*to+o[B+1]*ro+o[I+1]*ro+o[E+1]*ao+o[F+1]*eo+o[G+1]*io+o[H+1]*uo+o[G+1]*uo+o[K+1]*fo+o[L+1]*co+o[N+1]*lo+o[Q+1]*so+o[N+1]*so+o[T+1]*vo+o[U+1]*po+o[V+1]*mo+o[W+1]*ho+o[V+1]*ho,p=o[w+2]*Y+o[P+2]*Z+o[q+2]*$+o[S+2]*_+o[q+2]*_+o[j+2]*oo+o[D+2]*no+o[I+2]*to+o[B+2]*ro+o[I+2]*ro+o[E+2]*ao+o[F+2]*eo+o[G+2]*io+o[H+2]*uo+o[G+2]*uo+o[K+2]*fo+o[L+2]*co+o[N+2]*lo+o[Q+2]*so+o[N+2]*so+o[T+2]*vo+o[U+2]*po+o[V+2]*mo+o[W+2]*ho+o[V+2]*ho,d=e?o[w+3]*Y+o[P+3]*Z+o[q+3]*$+o[S+3]*_+o[q+3]*_+o[j+3]*oo+o[D+3]*no+o[I+3]*to+o[B+3]*ro+o[I+3]*ro+o[E+3]*ao+o[F+3]*eo+o[G+3]*io+o[H+3]*uo+o[G+3]*uo+o[K+3]*fo+o[L+3]*co+o[N+3]*lo+o[Q+3]*so+o[N+3]*so+o[T+3]*vo+o[U+3]*po+o[V+3]*mo+o[W+3]*ho+o[V+3]*ho:o[l+3],u&&(s=v=p=(s+v+p)/3),i&&(s=255-s,v=255-v,p=255-p),n[l]=s,n[l+1]=v,n[l+2]=p,n[l+3]=d}function gaussian(o,n,t,r,a){var e,i,u,f,c,l,s,v,p,d,m,h,x,g,O,M=[],b=13,y=[[1]];for(a=clamp(a,3,b),x=-a/2+(a%2?.5:0),g=a+x,u=1;b>u;u+=1)y[0][u]=0;for(u=1;b>u;u+=1)for(y[u]=[1],f=1;b>f;f+=1)y[u][f]=y[u-1][f]+y[u-1][f-1];for(O=y[a-1],u=0,h=0;a>u;u+=1)h+=O[u];for(u=0;a>u;u+=1)O[u]/=h;for(i=0;r>i;i+=1)for(e=0;t>e;e+=1){for(c=l=s=v=0,u=x;g>u;u+=1)d=e+u,m=i,h=O[u-x],0>d&&(d=0),d>=t&&(d=t-1),p=4*(m*t+d),c+=o[p]*h,l+=o[p+1]*h,s+=o[p+2]*h,v+=o[p+3]*h;p=4*(i*t+e),M[p]=c,M[p+1]=l,M[p+2]=s,M[p+3]=v}for(i=0;r>i;i+=1)for(e=0;t>e;e+=1){for(c=l=s=v=0,u=x;g>u;u+=1)d=e,m=i+u,h=O[u-x],0>m&&(m=0),m>=r&&(m=r-1),p=4*(m*t+d),c+=M[p]*h,l+=M[p+1]*h,s+=M[p+2]*h,v+=M[p+3]*h;p=4*(i*t+e),n[p]=c,n[p+1]=l,n[p+2]=s,n[p+3]=v}}function getPixel(o,n){return n*=4,[o[n+0],o[n+1],o[n+2],o[n+3]]}function setPixel(o,n,t){n*=4,o[n+0]=t[0],o[n+1]=t[1],o[n+2]=t[2],o[n+3]=t[3]}function polar(o,n,t,r,a,e,i){t=a/2+(t||0),r=e/2+(r||0);var u,f,c,l,s,v,p;for(u=0;e>u;u+=1)for(f=0;a>f;f+=1)c=f-t,l=u-r,s=Math.sqrt(Math.pow(c,2)+Math.pow(l,2)),v=Math.atan2(l,c),p=i(s,v),s=p[0],v=p[1],setPixel(n,f+u*a,getPixel(o,Math.round(t+Math.cos(v)*s)+Math.round(r+Math.sin(v)*s)*a))}var stackblur=require("stackblur"),util=require("./util"),clamp=util.clamp,process={invert:function(o,n,t,r){var a,e=t*r*4;for(a=0;e>a;a+=4)n[a]=255-o[a],n[a+1]=255-o[a+1],n[a+2]=255-o[a+2],n[a+3]=o[a+3]},sepia:function(o,n,t,r){var a,e,i,u,f=t*r*4;for(a=0;f>a;a+=4)e=o[a],i=o[a+1],u=o[a+2],n[a]=.393*e+.769*i+.189*u,n[a+1]=.349*e+.686*i+.168*u,n[a+2]=.272*e+.534*i+.131*u,n[a+3]=o[a+3]},solarize:function(o,n,t,r){var a,e,i,u,f=t*r*4;for(a=0;f>a;a+=4)e=o[a],i=o[a+1],u=o[a+2],n[a]=e>127?255-e:e,n[a+1]=i>127?255-i:i,n[a+2]=u>127?255-u:u,n[a+3]=o[a+3]},brightness:function(o,n,t,r,a){a=defaultOptions(a,{brightness:1,contrast:0});var e,i,u,f,c,l=t*r*4,s=clamp(a.contrast,-1,1)/2,v=1+clamp(a.brightness,-1,1),p=0>v?-v:v,d=0>v?0:v;for(s=.5*Math.tan((s+1)*Math.PI/4),c=255*-(s-.5),e=0;l>e;e+=4)i=o[e],u=o[e+1],f=o[e+2],i=(i+i*p+d)*s+c,u=(u+u*p+d)*s+c,f=(f+f*p+d)*s+c,n[e]=i,n[e+1]=u,n[e+2]=f,n[e+3]=o[e+3]},desaturate:function(o,n,t,r){var a,e,i=t*r*4;for(a=0;i>a;a+=4)e=.3*o[a]+.59*o[a+1]+.11*o[a+2],n[a]=e,n[a+1]=e,n[a+2]=e,n[a+3]=o[a+3]},lighten:function(o,n,t,r,a){a=defaultOptions(a,{amount:.25});var e,i=t*r*4,u=1+clamp(a.amount,0,1);for(e=0;i>e;e+=4)n[e]=o[e]*u,n[e+1]=o[e+1]*u,n[e+2]=o[e+2]*u,n[e+3]=o[e+3]},noise:function(o,n,t,r,a){a=defaultOptions(a,{amount:.5,strength:.5,mono:!1});var e,i,u,f,c,l=t*r*4,s=clamp(a.amount,0,1),v=clamp(a.strength,0,1),p=!!a.mono,d=Math.random;for(e=0;l>e;e+=4)u=o[e],f=o[e+1],c=o[e+2],i=d(),s>i&&(p?(i=v*(i/s*2-1)*255,u+=i,f+=i,c+=i):(u+=v*d()*255,f+=v*d()*255,c+=v*d()*255)),n[e]=u,n[e+1]=f,n[e+2]=c,n[e+3]=o[e+3]},flipv:function(o,n,t,r){var a,e,i,u;for(e=0;r>e;e+=1)for(a=0;t>a;a+=1)i=4*(e*t+a),u=4*(e*t+(t-a-1)),n[u]=o[i],n[u+1]=o[i+1],n[u+2]=o[i+2],n[u+3]=o[i+3]},fliph:function(o,n,t,r){var a,e,i,u;for(e=0;r>e;e+=1)for(a=0;t>a;a+=1)i=4*(e*t+a),u=4*((r-e-1)*t+a),n[u]=o[i],n[u+1]=o[i+1],n[u+2]=o[i+2],n[u+3]=o[i+3]},blur:function(o,n,t,r,a){a=defaultOptions(a,{radius:10});for(var e=0;e<o.length;e+=1)n[e]=o[e];stackblur(n,t,r,a.radius)},glow:function(o,n,t,r,a){a=defaultOptions(a,{amount:.75,kernelSize:5});var e,i,u,f,c=t*r*4,l=a.amount,s=[];for(gaussian(o,s,t,r,a.kernelSize),e=0;c>e;e+=4)i=o[e]+s[e]*l,u=o[e+1]+s[e+1]*l,f=o[e+2]+s[e+2]*l,i>255&&(i=255),u>255&&(u=255),f>255&&(f=255),n[e]=i,n[e+1]=u,n[e+2]=f,n[e+3]=o[e+3]},convolve3x3:function(o,n,t,r,a){convolve3x3(o,n,t,r,a.kernel)},convolve5x5:function(o,n,t,r,a){convolve5x5(o,n,t,r,a.kernel)},sharpen3x3:function(o,n,t,r,a){a=defaultOptions(a,{strength:1});var e=-clamp(a.strength,0,1);convolve3x3(o,n,t,r,[[e,e,e],[e,1-8*e,e],[e,e,e]])},sharpen5x5:function(o,n,t,r,a){a=defaultOptions(a,{strength:1});var e=-clamp(a.strength,0,1);convolve5x5(o,n,t,r,[[e,e,e,e,e],[e,e,e,e,e],[e,e,1-24*e,e,e],[e,e,e,e,e],[e,e,e,e,e]])},soften3x3:function(o,n,t,r){var a=1/9;convolve3x3(o,n,t,r,[[a,a,a],[a,a,a],[a,a,a]])},soften5x5:function(o,n,t,r){var a=.04;convolve5x5(o,n,t,r,[[a,a,a,a,a],[a,a,a,a,a],[a,a,a,a,a],[a,a,a,a,a],[a,a,a,a,a]])},crossedges:function(o,n,t,r,a){a=defaultOptions(a,{strength:1});var e=5*clamp(a.strength,0,1);convolve3x3(o,n,t,r,[[0,-e,0],[-e,0,e],[0,e,0]],!1,!0)},emboss:function(o,n,t,r,a){a=defaultOptions(a,{amount:1,angle:0});var e,i=t*r*4,u=a.amount,f=a.angle,c=Math.cos(-f)*u,l=Math.sin(-f)*u,s=-c-l,v=-c,p=l-c,d=-l,m=l,h=-l+c,x=c,g=l+c,O=[];for(convolve3x3(o,O,t,r,[[s,d,h],[v,0,x],[p,m,g]]),e=0;i>e;e+=4)n[e]=128+O[e],n[e+1]=128+O[e+1],n[e+2]=128+O[e+2],n[e+3]=o[e+3]},findedges:function(o,n,t,r){var a,e,i,u,f,c,l,s=t*r*4,v=[],p=[];for(convolve3x3(o,v,t,r,[[-1,0,1],[-2,0,2],[-1,0,1]]),convolve3x3(o,p,t,r,[[-1,-2,-1],[0,0,0],[1,2,1]]),a=0;s>a;a+=4)e=v[a],i=p[a],u=v[a+1],f=p[a+1],c=v[a+2],l=p[a+2],0>e&&(e=-e),0>i&&(i=-i),0>u&&(u=-u),0>f&&(f=-f),0>c&&(c=-c),0>l&&(l=-l),n[a]=255-.8*(e+i),n[a+1]=255-.8*(u+f),n[a+2]=255-.8*(c+l),n[a+3]=o[a+3]},edgeenhance3x3:function(o,n,t,r){var a=-1/9;convolve3x3(o,n,t,r,[[a,a,a],[a,17/9,a],[a,a,a]])},edgeenhance5x5:function(o,n,t,r){var a=-0.04;convolve5x5(o,n,t,r,[[a,a,a,a,a],[a,a,a,a,a],[a,a,1.96,a,a],[a,a,a,a,a],[a,a,a,a,a]])},laplace3x3:function(o,n,t,r){convolve3x3(o,n,t,r,[[-1,-1,-1],[-1,8,-1],[-1,-1,-1]],!1,!0,!0)},laplace5x5:function(o,n,t,r){convolve5x5(o,n,t,r,[[-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1],[-1,-1,24,-1,-1],[-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1]],!1,!0,!0)},coloradjust:function(o,n,t,r,a){a=defaultOptions(a,{r:0,g:0,b:0});var e,i,u,f,c=t*r*4,l=255*clamp(a.r,-1,1),s=255*clamp(a.g,-1,1),v=255*clamp(a.b,-1,1);for(e=0;c>e;e+=4)i=o[e]+l,u=o[e+1]+s,f=o[e+2]+v,0>i&&(i=0),0>u&&(u=0),0>f&&(f=0),i>255&&(i=255),u>255&&(u=255),f>255&&(f=255),n[e]=i,n[e+1]=u,n[e+2]=f,n[e+3]=o[e+3]},colorfilter:function(o,n,t,r,a){a=defaultOptions(a,{luminosity:!1,r:1,g:.5,b:0});var e,i,u,f,c,l,s,v,p,d,m,h=t*r*4,x=!!a.luminosity,g=clamp(a.r,0,1),O=clamp(a.g,0,1),M=clamp(a.b,0,1);for(e=0;h>e;e+=4)i=o[e]/255,u=o[e+1]/255,f=o[e+2]/255,v=.3*i+.59*u+.11*f,i=(i+i*g)/2,u=(u+u*O)/2,f=(f+f*M)/2,x&&(c=l=i,u>l&&(l=u),f>l&&(l=f),c>u&&(c=u),c>f&&(c=f),d=l-c,s=i===l?(u-f)/d%6:u===l?(f-i)/d+2:(i-u)/d+4,p=s>>0,m=d*(s-p),i=u=f=v-(.3*i+.59*u+.11*f),0===p?(i+=d,u+=m):1===p?(i+=d-m,u+=d):2===p?(u+=d,f+=m):3===p?(u+=d-m,f+=d):4===p?(i+=m,f+=d):5===p&&(i+=d,f+=d-m)),n[e]=255*i,n[e+1]=255*u,n[e+2]=255*f,n[e+3]=o[e+3]},hsl:function(o,n,t,r,a){a=defaultOptions(a,{hue:.5,saturation:.3,lightness:.1});var e,i,u,f,c,l,s,v,p,d,m,h,x,g,O=t*r*4,M=clamp(a.hue,-1,1),b=clamp(a.saturation,-1,1),y=clamp(a.lightness,-1,1),z=1+b*(0>b?1:2),k=0>y?1+y:1-y,w=0>y?0:255*y;for(M=6*M%6,e=0;O>e;e+=4)i=o[e],u=o[e+1],f=o[e+2],(0!==M||0!==b)&&(c=i,u>c&&(c=u),f>c&&(c=f),l=i,l>u&&(l=u),l>f&&(l=f),s=c-l,d=(l+c)/510,d>0&&s>0&&(.5>=d?(p=s/(c+l)*z,p>1&&(p=1),m=d*(1+p)):(p=s/(510-c-l)*z,p>1&&(p=1),m=d+p-d*p),v=i===c?u===l?5+(c-f)/s+M:1-(c-u)/s+M:u===c?f===l?1+(c-i)/s+M:3-(c-f)/s+M:i===l?3+(c-u)/s+M:5-(c-i)/s+M,0>v&&(v+=6),v>=6&&(v-=6),h=d+d-m,g=v>>0,x=(m-h)*(v-g),0===g?(i=m,u=h+x,f=h):1===g?(i=m-x,u=m,f=h):2===g?(i=h,u=m,f=h+x):3===g?(i=h,u=m-x,f=m):4===g?(i=h+x,u=h,f=m):5===g&&(i=m,u=h,f=m-x),i*=255,u*=255,f*=255)),i=i*k+w,u=u*k+w,f=f*k+w,0>i&&(i=0),0>u&&(u=0),0>f&&(f=0),i>255&&(i=255),u>255&&(u=255),f>255&&(f=255),n[e]=i,n[e+1]=u,n[e+2]=f,n[e+3]=o[e+3]},posterize:function(o,n,t,r,a){a=defaultOptions(a,{levels:5});var e,i=t*r*4,u=clamp(a.levels,2,256),f=256/u,c=256/(u-1);for(e=0;i>e;e+=4)n[e]=c*(o[e]/f>>0),n[e+1]=c*(o[e+1]/f>>0),n[e+2]=c*(o[e+2]/f>>0),n[e+3]=o[e+3]},removenoise:function(o,n,t,r){var a,e,i,u,f,c,l,s,v,p,d,m,h,x,g,O,M,b,y;for(e=0;r>e;e+=1)for(s=e*t*4,v=s-4*t,p=s+4*t,1>e&&(v=s),e>=t-1&&(p=s),a=0;t>a;a+=1)l=4*(e*t+a),d=4*a,m=d-4,h=d+4,1>a&&(m=d),a>=t-1&&(h=d),x=M=o[s+m],c=o[s+h],x>c&&(x=c),c>M&&(M=c),c=o[v+d],x>c&&(x=c),c>M&&(M=c),c=o[p+d],x>c&&(x=c),c>M&&(M=c),g=o[s+m+1],c=o[s+h+1],g>c&&(g=c),c=o[v+d+1],g>c&&(g=c),c=o[p+d+1],g>c&&(g=c),O=o[s+m+2],c=o[s+h+2],O>c&&(O=c),c=o[v+d+2],O>c&&(O=c),c=o[p+d+2],O>c&&(O=c),i=o[l],u=o[l+1],f=o[l+2],x>i&&(i=x),i>M&&(i=M),g>u&&(u=g),u>b&&(u=b),O>f&&(f=O),f>y&&(f=y),n[l]=i,n[l+1]=u,n[l+2]=f,n[l+3]=o[l+3]},mosaic:function(o,n,t,r,a){a=defaultOptions(a,{blockSize:8});var e,i,u,f,c,l,s,v,p,d,m,h,x,g,O=clamp(a.blockSize,1,Math.max(t,r)),M=Math.ceil(r/O),b=Math.ceil(t/O);for(e=0,p=0,s=0;M>s;s+=1){for(i=clamp(e+O,0,r),u=0,v=0;b>v;v+=1){for(f=clamp(u+O,0,t),c=e*t+u<<2,d=o[c],m=o[c+1],h=o[c+2],x=e;i>x;x+=1)for(g=u;f>g;g+=1)l=x*t+g<<2,n[l]=d,n[l+1]=m,n[l+2]=h,n[l+3]=o[l+3];u=f,p+=1}e=i}},equalize:function(o,n,t,r,a){var e,i,u,f,c=t*r,l=Math.round,s=new Array(256);for(i=0;256>i;i+=1)s[i]=0;for(i=0;c>i;i+=1)e=4*i,u=clamp(l(.3*o[e]+.59*o[e+1]+.11*o[e+2]),0,255),n[e+3]=u,s[u]+=1;var v=new Array(256);for(v[0]=s[0],i=1;256>i;i+=1)v[i]=v[i-1]+s[i];for(i=0;256>i;i+=1)v[i]=v[i]/c*255;for(i=0;c>i;i+=1)e=4*i,u=n[e+3],f=v[u]/(u||1),n[e]=clamp(l(o[e]*f),0,255),n[e+1]=clamp(l(o[e+1]*f),0,255),n[e+2]=clamp(l(o[e+2]*f),0,255),n[e+3]=o[e+3]},luminancebw:function(o,n,t,r){var a,e,i=t*r*4;for(a=0;i>a;a+=4)e=.2125*o[a]+.7154*o[a+1]+.0721*o[a+2],n[a]=e,n[a+1]=e,n[a+2]=e,n[a+3]=o[a+3]},mask:function(o,n,t,r,a){var e,i=t*r*4,u=a.data;for(e=0;i>e;e+=4)n[e]=o[e],n[e+1]=o[e+1],n[e+2]=o[e+2],n[e+3]=o[e+3]*u[e]/255*u[e+3]/255},bump:function(o,n,t,r,a){a=defaultOptions(a,{dx:0,dy:0,radius:0,zoom:0});var e=a.radius,i=clamp(a.zoom,0,1);return polar(o,n,a.dx,a.dy,t,r,function(o,n){return[o*smoothstep(0,i,o/e),n]})},dent:function(o,n,t,r,a){a=defaultOptions(a,{dx:0,dy:0,radius:0,zoom:0});var e=a.radius,i=clamp(a.zoom,0,1);return polar(o,n,a.dx,a.dy,t,r,function(o,n){return[2*o-o*smoothstep(0,i,o/e),n]})},pinch:function(o,n,t,r,a){a=defaultOptions(a,{dx:0,dy:0,zoom:0});var e=util.distance(0,0,t,r),i=clamp(.75*a.zoom,-.75,.75);return polar(o,n,a.dx,a.dy,t,r,function(o,n){return[o*Math.pow(e/o,i)*(1-i),n]})},splash:function(o,n,t,r,a){a=defaultOptions(a,{dx:0,dy:0,radius:0});var e=a.radius;return polar(o,n,a.dx,a.dy,t,r,function(o,n){return[o>e?e:o,n]})},twirl:function(o,n,t,r,a){a=defaultOptions(a,{dx:0,dy:0,radius:0,angle:0});var e=util.radians(a.angle),i=a.radius;return polar(o,n,a.dx,a.dy,t,r,function(o,n){return[o,n+(1-smoothstep(-i,i,o))*e]})}};module.exports=process;


},{"./util":9,"stackblur":3}],9:[function(require,module,exports){
"use strict";function degrees(n){return 180*n/Math.PI}function radians(n){return n/180*Math.PI}function distance(n,t,r,a){return Math.sqrt(Math.pow(r-n,2)+Math.pow(a-t,2))}function clamp(n,t,r){return Math.min(r,Math.max(t,n))}function transform(n){function t(n,t){t=t.slice();{var r=t[0],a=t[1],e=(t[2],t[3]),i=t[4],o=(t[5],t[6]),u=t[7];t[8]}return t[0]=n[0]*r+n[1]*e,t[1]=n[0]*a+n[1]*i,t[3]=n[3]*r+n[4]*e,t[4]=n[3]*a+n[4]*i,t[6]=n[6]*r+n[7]*e+o,t[7]=n[6]*a+n[7]*i+u,transform(t)}return n=void 0===n?[1,0,0,0,1,0,0,0,1]:n.slice(),{matrix:function(){return n.slice()},clone:function(){return transform(n)},prepend:function(r){return r.matrix&&(r=r.matrix()),t(n,r)},append:function(r){return r.matrix&&(r=r.matrix()),t(r,n)},translate:function(r,a){return t([1,0,0,0,1,0,r,a,1],n)},scale:function(r,a){return void 0===a&&(a=r),t([r,0,0,0,a,0,0,0,1],n)},skew:function(r,a){void 0===a&&(a=r);var e=Math.PI*r/180,i=Math.PI*a/180;return t([1,Math.tan(i),0,-Math.tan(e),1,0,0,0,1],n)},rotate:function(r){var a=Math.cos(radians(r)),e=Math.sin(radians(r));return t([a,e,0,-e,a,0,0,0,1],n)},transformPoint:function(t){var r=t.x,a=t.y;return{x:r*n[0]+a*n[3]+n[6],y:r*n[1]+a*n[4]+n[7]}}}}module.exports={degrees:degrees,radians:radians,distance:distance,clamp:clamp,transform:transform};


},{}]},{},[7])(7)
});